# [Django News Portal](http://127.0.0.1:8000/news/)


## Содержание

[1. Описание проекта](README.md#Описание-проекта)  
[2. Функционал и задачи проекта](README.md#Функционал-и-задачи-проекта)  
[3. Установка и запуск](README.md#Установка-и-запуск)  


## Описание проекта

Это проект новостного портала на основе Django, который включает функционал рейтинговой системы для авторов, комментариев и постов, а также предлагает функционал подписки на категории с оповещением пользователей при появлении новых постов, позволяет зарегестрированным пользователям публиковать, комментировать и оценивать новости и статьи

:arrow_up: [к содержанию](README.md#Содержание)


## Функционал и задачи проекта

#### Модели

- Описание структуры и создание реляционной базы данных на базе SQLite
- Модели `Author`, `Category`, `Post`, `PostCategory`, `Comment`, присутствуют все типы связи `o2o`, `o2m`, `m2m`
- Работа с базой данных через Django Shell, файл с запросами - [HMW_2_models.md](newspaper/HMW_2_models.md)

#### Представление и шаблоны

- Создание представлений всех элементов модели в таблице и каждого элемента в отдельности с помощью дженериков `ListView` и `DetailView`. 
- Реализация собственного фильтра `censor`, который заменяет буквы нежелательных слов в заголовках и текстах статей на символ `*`.

#### Фильтры, формы и пагинация

- Реализация фильтра всех постов с помощью библиотеки `django-filter`
- Формы создания, редактирования и удаления постов, с помощью дженериков `CreateView`, `UpdateView`, `DeleteView`.
- Настройка пагинации на страницах и реализация кастомного тега `url_replace` для работы пагинации вместе с фильтрами

#### Авторизация и регистрация

- Установка и настройки пакета `allauth`.
- Добавления различных видов регистрации, стандартный и через социальный аккаунт Yandex.
- Добавление пользователей в различные группы через администратора и регистрацию с разными уровнями разрешений.
- Закрытия доступа к добавления/изменения/удаления для пользователей без разрешений.
- Ограничение навигации в шаблонах только для пользователей без разрешений.

#### Работа с почтой выполнение задач по расписанию

- Реализация подписки на категорию, добавлено поле `subscribers` в модели `Category` для связи `m2m` с моделью `User`.
- Настройка рассылки писем пользователям через почтовый сервис Yandex.
- Настройка и работа с сигналами, добавлена рассылки о создании нового поста пользователям подписаным на категорию.
- Реализация периодической рассылки о всех вышедших постах в категории за неделю через библиотеку `django-apscheduler`.

#### Работа с асинхронными задачами через Celery

- Установка и настройка Redis для организации очереди задач на сервере.
- Установка и настройка Celery для работы с очередью задач.
- Реализация асинхронной рассылки уведомлений подписчикам после создания новости. 
- Реализация еженедельной рассылки с последними новостями через Celery beat.

#### Кэширование

- Кэширование статической информации и других частей шаблонов.
- Добавление кеширование объектов между сохранениями.

#### Управляющие команды и настройка панели администратора

- Реализация консольной команды для удаления всех постов по выбранной категории.
- Добавление удобного вывода и фильтров моделей в панели администратора, реализация удобного поиска.

#### Логирование

- Настройка логов в `settings.py`, описание логгеров, обработчиков, фильтров и форматов.
- Фильтрация логов по уровню для настройки форматирования в обработчиках.
- Вывод логов в консоль, файл или электронную почту в зависимости от уровней и логгеров.

#### Локализация и интернационализация 

- Добавлена переводы через `gettext` для текста в файлах и шаблонах, а так же через `modeltranslation` реализован перевод моделей.
- Добавлена локализация времени и возможность пользователю выбирать часовой пояс.
- Реализована смена тёмной или светлой темы оформления в зависимости от времени пользователя.

:arrow_up: [к содержанию](README.md#Содержание)


## Установка и запуск

#### Клонируйте проект с GitHub локально и перейдите в папку `news-portal`:

```bash
git clone https://github.com/Exspakz/news-portal.git
cd news-portal
```

#### Создайте виртуальное окружение для проекта:

```bash
python -m venv venv_newspaper
source venv_newspaper/bin/activate
```

#### Установите необходимые пакеты из файла `newspaper/requirements.txt`:
```bash
pip install -r newspaper/requirements.txt 
```

#### Сгенерировать секретный ключ Django:

```bash
python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
```

#### Отправка e-mail писем происходит с помощью сервиса Yandex.

Для настройки выполните Шаг 1 и Шаг 2 по инструкции: [Настроить программу по протоколу IMAP](https://yandex.ru/support/mail/mail-clients/others.html). Сохраните пароль приложения - он понадобится на следующем шаге.


#### В файле `newspaper/.env.Example` замените шаблонные переменные окружения:

```python
# django
SECRET_KEY = 'SECRET_KEY'

# yandex api
EMAIL = 'DEFAULT_FROM_EMAIL'
EMAIL_HOST_USER = 'EMAIL_HOST_USER'
PASSWORD_API = 'EMAIL_HOST_PASSWORD'
```

#### Установите сервер Redis локально в вашей операционной системе:

```bash
sudo apt-get update  
sudo apt-get install redis  
```

#### Или подключите через облачную базу данных Redis, тогда в файле `newspaper/.env.Example` замените переменные окружения:

```python
# celery
USERNAME_REDIS = 'USERNAME_REDIS'
PASSWORD_REDIS = 'PASSWORD_REDIS'
ENDPOINT = 'ENDPOINT'
```

#### Создайте и примените миграции из каталога проекта */newspaper/*:
```bash
python manage.py makemigrations 
python manage.py migrate 
```

#### Запуск проекта, выполните команды в отдельных консольных окнах:

 - `redis-server` - сервер Redis, если он установлен локально  
 - `celery -A newspaper worker -l INFO -B` - Celery из каталога проекта */newspaper/*
 - `python manage.py runserver` - запуск Django-проекта из каталога проекта */newspaper/*

:arrow_up: [к содержанию](README.md#Содержание)